{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container-fluid">


    <!-- Blog Entries Column -->
    <div class="col-12 mt-3 left">

        <div id="post-container">
            {% for post in post_list %}
            <!-- <div class="col-md-4 mx-auto"> -->
            <!-- <div class="card mb-4 mx-auto"> -->



            <div class="image-container">

                <img src="{% static 'images/gb.png' %}" class="gold-border">
                <img class="card-img-top" src="{{ post.featured_image.url }}">
                <img src="{% static 'images/gbbottom.png' %}" class="gold-border">
                <div class="image-flash">

                    <p>
                        <a href="{% url 'user_profile' post.author.username %}" class=" author author-link">{{
                            post.author }}</a>

                    </p>
                </div>
            </div>

            <a href="{% url 'post_detail' post.slug  %}" class="post-link">
                <p class="text-muted"> {{ post.location }}</p>
                <h2 class="card-title">{{ post.title }}</h2>
                <p class="card-text">{{ post.excerpt }}</p>
            </a>


            <!-- post info -->
            <ul class="list-unstyled info-list text-muted">
                <!-- <li>location: {{ post.location }} </li> -->
                <li class="like-icon"><i class="far fa-heart"></i> {{ post.number_of_likes }}</li>

                <!-- <li><i class="far fa-heart"></i> {{ post.number_of_likes }}</li> -->
                <!-- <li><i class="far fa-heart"></i> {{ post.number_of_likes }}</li> -->

                <li>km: {{ post.kilometers_ran }}</li>
                <li>duration: {{ post.duration }}</li>
                <li class=" ">{{ post.created_on }}</li>
            </ul>
            <!--  -->



            <div class="mt-3">


                {% if user.is_authenticated and post.author == user %}
                <a href="{% url 'update_post' post.slug %}" class="update-btn">update</a>
                <a href="{% url 'delete_post' post.slug %}" class="delete-btn">delete</a>

                {% endif %}



            </div>

            <!-- <hr /> -->





        </div>
    </div>
    {% if forloop.counter|divisibleby:3 %}
</div>


<!-- javascript  -->
<script>
    var page = 1; // Initialize the page number
    var loading = false; // Track if a loading request is in progress

    function loadMorePosts() {
        var windowHeight = window.innerHeight;
        var documentHeight = document.body.scrollHeight;
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (windowHeight + scrollTop >= documentHeight - 100 && !loading) {
            // User has scrolled to the bottom, load more posts
            loading = true;
            page++;
            var url = `/get_paginated_posts/${page}/`;

            // Show loading indicator
            document.getElementById('loading-indicator').style.display = 'block';

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    loading = false; // Reset loading status
                    // Hide loading indicator
                    document.getElementById('loading-indicator').style.display = 'none';

                    // Append the new posts to the post container
                    data.posts.forEach(function (post) {
                        var postElement = document.createElement('div');
                        postElement.innerHTML = `
                                        <h2>${post.title}</h2>
                                        <p>${post.content}</p>
                                    `;
                        document.getElementById('post-container').appendChild(postElement);
                    });
                });
        }
    }

    // Attach the loadMorePosts function to the window's scroll event
    window.addEventListener('scroll', loadMorePosts);
</script>

<!--  -->

<!-- no idea what this does-->
{% endif %}
{% endfor %}
<!-- no idea what this does-->


</div>
<div id="loading-indicator" style="display: none;" class="tricolor">
    Loading...

</div>
{%endblock%}